
<% data = @route %>;
<% size = data.steps.length %>;
var start = new google.maps.LatLng(<%= j data.steps[0].geocode%>);
console.log("2")
var end = new google.maps.LatLng(<%= j data.steps[size-1].geocode%>);
console.log(typeof(gon.mode))
var selectedMode = gon.mode.toUpperCase();
console.log("3")
var waypts = [];
var loc;
<% data.steps.each do |step| %>
	loc = new google.maps.LatLng(<%= j step.geocode%>);
	waypts.push({
	    location: loc,
	    stopover: true
	});
<%end%>
var request = {
	origin:start,
	destination:end,
	travelMode: google.maps.TravelMode[selectedMode],
	optimizeWaypoints: false,
	waypoints: waypts
};

directionsService.route(request, function(response, status) {
	if (status == google.maps.DirectionsStatus.OK) {
	  directionsDisplay.setDirections(response);
	}
});